<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVP5MJERRY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-EVP5MJERRY');
    </script>
    <!-- Meta Pixel Code -->
    <script>
        function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '827137978479661');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
                   src="https://www.facebook.com/tr?id=827137978479661&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    <!-- Hotjar Tracking Code for https://villagelife.bg -->
    <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3202998,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
    <meta charset="UTF-8">

    <meta name="robots" content="all">
    <title th:text="#{property.title}"></title>
    <link th:href="@{/images/village-life-logo-icon.png}" rel="icon" type="image/png"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/0.8.2/css/flag-icon.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="/css/min/list-properties.min.css">
    <link rel="stylesheet" href="/css/min/menu-style-about-us.min.css">
</head>
<body>
<div th:replace="fragments :: property-menu"></div>
<div th:replace="fragments :: property-hamburger-menu"></div>
<div class="container">


    <div class="row col-12">
        <div th:each="property : ${properties}" class="col-lg-4 col-md-6 col-sm-12 property">
            <div class="card">
                <div class="image-container">
                    <img alt="pictures of all properties"
                         th:src="'data:image/jpeg;base64,' + ${property.imageUrl}"
                         onerror="this.onerror=null;this.src='/images/pexels-alexander-kovalev-2871478.webp';" loading="lazy" width="1024" height="683">
                </div>

                <div class="card-body">
                    <a th:href="@{/properties/show/{id}(id=${property.id})}" class="card-body-link">
                        <h6 style="font-weight: 400; text-transform: uppercase;">
                            <div th:text="#{${property.propertyTransferType.name}}"></div>
                        </h6>
                        <h5>
                            <span th:text="#{${property.propertyType.key}}"></span>, <span th:text="${property.price} + ' EUR'"></span>
                        </h5>
                        <h6><span th:text="#{village}"></span>
                            <span th:if="${#locale.language == 'bg'}" th:text="${property.villageDTO.name} + ', '"></span>
                            <span th:if="${#locale.language == 'en'}" th:text="${property.villageDTO.latinName} + ', '"></span>
                            <span th:if="${#locale.language == 'de'}" th:text="${property.villageDTO.latinName} + ', '"></span>
                            <span th:text="#{region}"></span>
                            <span th:text="#{${property.villageDTO.region}}"></span>
                        </h6>
                    </a>
                    <br>
                    <a th:href="@{/properties/show/{id}(id=${property.id})}" class="btn btn-info" style="font-size: 15px;"><span th:text="#{property.see.more}"></span></a>
                </div>
            </div>
        </div>
    </div>


    <div class="card-actions" style="font-size: 15px;">
        <div class="text-center pagination">
            <div>
                <a th:href="@{/properties}" aria-label="to the first page">
                    <button id="first" class="btn">
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                </a>
            </div>

            <div>
                <a th:href="@{/properties/{page}(page=${page >= 1 ? page - 1 : 0})}">
                    <button id="prev" class="btn">
                        <i class="fas fa-chevron-left"></i><span th:text="#{previous.page}" class="pagination-btn-text"></span>
                    </button>
                </a>
            </div>

            <div>
                <input type="number" id="currentPage" th:value="${page != null ? page + 1 : 1}"
                       onkeyup="updatePageValue(event)" style="width: 50px;" aria-labelledby="number">

                <span th:text="#{from.page}"></span>
                <span th:text="${pagesCount}"></span>
            </div>

            <div>
                <a th:href="@{/properties/{page}(page=${page != null ? (page < pagesCount - 1 ? page + 1 : pagesCount - 1) : 1})}">
                    <button id="next" class="btn">
                        <span th:text="#{next.page}" class="pagination-btn-text"></span>  <i class="fas fa-chevron-right"></i>
                    </button>
                </a>
            </div>
            <div>
                <a th:href="@{/properties/{page}(page=${pagesCount - 1})}" aria-label="to the last page">
                    <button id="last" class="btn">
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </a>
            </div>
        </div>
    </div>


</div>

<div th:replace="fragments :: footer"></div>

<script>
function updatePageValue(event) {
    if (event.key === 'Enter') {
        var currentPageInput = document.getElementById('currentPage');
        var pageCount = [[${pagesCount}]];
        var currentPageValue = parseInt(currentPageInput.value);

        if (currentPageValue >= 0 && currentPageValue <= pageCount) {
            var newPageValue = currentPageValue - 1;
            if (newPageValue >= 0) {
                var currentURL = window.location.href;
                var baseURL = currentURL.split('?')[0];
                var queryParams = currentURL.split('?')[1];

                var newBaseURL;
                if (baseURL.endsWith('/properties')) {
                    newBaseURL = baseURL + "/" + newPageValue;
                    console.log(newBaseURL)
                } else {
                    newBaseURL = baseURL.replace(/\/\d+$/, '/' + newPageValue);
                }

                var newURL = queryParams ? newBaseURL + '?' + queryParams : newBaseURL;
                window.location.href = newURL;
            }
        }
    }
}
</script>
<script src="/js/min/showSubscriptionToast.min.js"></script>
<script src="/js/min/properties-navScript.min.js"></script>
</body>
</html>