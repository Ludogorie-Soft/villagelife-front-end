<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Информация</title>
    <link th:href="@{/images/village-life-logo-icon.png}" rel="icon" type="image/png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
            integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/message.css">
    <link rel="stylesheet" href="/css/showVillageById.css">
    <link rel="stylesheet" href="/css/menuStyle.css">
</head>

<script src="/js/querySelector.js"></script>
<body>

<div th:replace="fragments :: menu"></div>
<div th:replace="fragments :: hamburger-menu"></div>

<div class="container">
    <div class="village-title">
        <h1 th:text="'село '+${villageInfo.villageDTO.name} + ', oбласт ' + ${villageInfo.villageDTO.region}"></h1>
        <input value='' type='button' onclick='handlePrint()' class="print-button"/>

        <img th:src="@{/images/point.png}" class="point-icon"><span
            th:text="'село '+${villageInfo.villageDTO.name} + ', България'" class="village-name"></span>
    </div>

    <div th:each="imageSrc, i : ${imageSrcList}" class="mySlides">
        <div class="village-image-container text-center">
            <div class="numbertext" th:text="${i.index + 1} + ' / ' + ${imageSrcList.size()}"></div>

            <img th:src="'data:image/jpeg;base64,' + ${imageSrc}"
                 onerror="this.onerror=null;this.src='/images/pexels-alexander-kovalev-2871478.jpg';">

            <a class="prev" th:if="${imageSrcList.size() > 1}" onclick="plusSlides(-1)">❮</a>
            <a class="next" th:if="${imageSrcList.size() > 1}" onclick="plusSlides(1)">❯</a>
        </div>
    </div>

    <div th:if="${admin != null}" class="row justify-content-center mt-3">
        <div class="col-sm-4">
            <form th:action="@{/admins/approve/{villageId}(villageId=${villageInfo.villageDTO.id})}" method="post"
                  class="btn-group btn-equal-size text-center">
                <input type="hidden" name="villageId" th:value="${villageInfo.villageDTO.id}">
                <input type="hidden" name="answerDate" th:value="${answerDate}">
                <button type="submit" class="btn btn-success" onclick="return showConfirmationApprove()">Одобри отговор</button>
            </form>
        </div>
        <div class="col-sm-4">
            <form th:if="${status != 'archived'}" id="rejectForm" th:action="@{/admins/reject/{villageId}(villageId=${villageInfo.villageDTO.id})}" method="post"
                  class="btn-group btn-equal-size text-center">
                <input type="hidden" name="villageId" th:value="${villageInfo.villageDTO.id}">
                <input type="hidden" name="answerDate" th:value="${answerDate}">
                <button type="submit" class="btn btn-primary" onclick="return showConfirmation()">Отхвърли отговор</button>
            </form>
            <p th:if="${status == 'archived'}" class="text-center" style="font-size: 1.2rem; font-weight: bold;">Този отговор вече е отхвърлен</p>
        </div>
        <div class="col-sm-4">
            <form th:if="${status != 'archived'}" th:action="@{/admins/village}" method="get" class="btn-group btn-equal-size text-center">
                <button type="submit" class="btn btn-danger">Назад към менюто</button>
            </form>
            <form th:if="${status == 'archived'}" th:action="@{/admins/getRejected}" method="get" class="btn-group btn-equal-size text-center">
                <button type="submit" class="btn btn-danger">Назад към архивираните села</button>
            </form>
        </div>
    </div>

    <div class="row">

        <p style="color: #B5B5B5; margin-top: 20px">
            Предоставената информация е ориентировъчна и с относителна достоверност<span th:text="${admin == null ? ', на базата на ' + villageInfo.villageDTO.approvedResponsesCount + ' отговор' + (villageInfo.villageDTO.approvedResponsesCount == 1 ? '' : 'а') : ''}"></span>.
        </p>


    <div class="col-lg-8 col-md-12 col-sm-12">
        <section class="general-information">
            <h3 class="section-title">Обща информация</h3>
            <div class="row">
                <hr>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div th:text="${villageInfo.populationDTO.populationCount}" class="village-info"></div>
                    <div class="info-title">Население</div>
                </div>

                <div class="col-lg-3 col-md-6 col-sm-6" th:each="condition : ${villageInfo.livingConditionResponses}"
                     th:if="${condition.livingCondition == 'Битови условия' or condition.livingCondition == 'Престъпност' or condition.livingCondition == 'Екосъобразност'}">
                    <div th:if="${condition.percentage == 0 and condition.livingCondition != 'Престъпност'}">
                        <div class="village-info">-</div>
                    </div>
                    <div th:unless="${condition.percentage == 0 and condition.livingCondition != 'Престъпност'}">
                        <div class="village-info" th:text="${condition.percentage + '%'}"></div>
                    </div>
                    <div class="info-title" th:text="${condition.livingCondition}"></div>
                </div>

            </div>
        </section>

        <section class="population">
            <h3 class="section-title">
                <img th:src="@{/images/crowd.png}" alt="distance" class="object-icon">
                <span>Население</span>
            </h3>
            <div class="row">
                <hr>
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col">Население: </span>
                                <span th:text="${villageInfo.populationDTO.populationCount}" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col">Деца: </span>
                                <span th:text="${villageInfo.populationDTO.children.name}" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col">Под 50г.: </span>
                                <span th:text="${villageInfo.populationDTO.residents.name}" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col">Чужденци: </span>
                                <span th:text="${villageInfo.populationDTO.foreigners.name}" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="row">
                                <span class="info-title col">Етнически състав: </span>
                                <span th:text="${villageInfo.ethnicities}" class="ethnicities village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="population-assertions" th:if="${not #lists.isEmpty(villageInfo.populationAssertionResponses)}">
            <h3 class="section-title">Характеристики на населението</h3>
            <div class="row">
                <hr>
                <div class="col-lg-6 col-md-6 col-sm-12" th:each="assertion : ${villageInfo.populationAssertionResponses}">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col" th:text="${assertion.populationAssertionName}"></span>
                                <span th:text="${assertion.percentage} + '%'" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="living-conditions">
            <h3 class="section-title">Условия на живот</h3>
            <hr>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="row">
                                <span class="info-title col">Категория/и на замята: </span>
                                <span th:text="${villageInfo.groundCategories}" class="groundCategory village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12" th:each="condition : ${villageInfo.livingConditionResponses}" th:if="${condition.livingCondition != 'Битови условия' and condition.livingCondition != 'Престъпност' and condition.livingCondition != 'Екосъобразност'}">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-11 col-md-11 col-sm-11">
                            <div class="row">
                                <span class="info-title col" th:text="${condition.livingCondition}"></span>
                                <span th:text="${condition.livingCondition == 'Достъпност' and condition.percentage == 0} ? '-' : (${condition.percentage} + '%')" class="village-info col"></span>
                                <hr>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="question-answers"  th:if="${not #lists.isEmpty(villageInfo.answersQuestionResponses)}">
            <h3 class="section-title">
                <img th:src="@{/images/answer.png}" alt="distance" class="object-icon">
                <span> Повече информация</span>
            </h3>

            <div class="accordion-container" th:each="answersQuestionResponse : ${villageInfo.answersQuestionResponses}">
                <button class="accordion" th:text="${answersQuestionResponse.question}"></button>
                <div class="panel">
                    <div class="answer-container" th:each="answer : ${answersQuestionResponse.answers}">
                        <p th:text="${answer}" class="answer"></p>
                        <hr>
                    </div>
                </div>
            </div>
        </section>

        <section class="objects" th:if="${not #lists.isEmpty(villageInfo.objectVillageResponses)}">
            <h3 class="section-title">Обекти</h3>
            <hr>
            <table  class="table">
                <tbody>
                <tr th:each="objectVillageResponse : ${villageInfo.objectVillageResponses}">
                    <td class="col-3 info-title">
                        <span th:text="${objectVillageResponse.distance.name}"></span>
                    </td>
                    <td class="col-10">
                        <img th:src="@{/images/building.png}" alt="distance" class="object-icon">
                        <span th:text="${objectVillageResponse.objects}"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>
    </div>

    <div class="col-lg-4 col-md-12 col-sm-12 sticky-form">
        <div class="lightbox-form-wrap">
            <div class="property-form-wrap">
                <div class="property-form clearfix">
                    <form method="post" action="/villages/inquiry-save" class="details" th:object="${inquiry}">
                        <div class="d-flex align-items-center text-center">
                            <div class="image-wrap">
                                <img class="rounded lazyload" src="/images/village-life-logo-circle.png"
                                     alt="VillageLife" width="70" height="70"
                                     decoding="async">
                                <noscript>
                                    <img class="rounded" src="/images/village-life-logo-circle.png"
                                         alt="VillageLife" width="70" height="70">
                                </noscript>
                            </div>
                            <ul class="information-wrap list-unstyled">
                                <li class="name"><i class="houzez-icon icon-single-neutral mr-1"></i> VillageLife</li>
                            </ul>
                        </div>

                        <div class="message-container">
                            <div class="message col-12 text-center" id="message"></div>
                        </div>

                        <input type="hidden" name="villageId" th:value="${villageInfo.villageDTO.id}">

                        <div class="form-group">
                            <input class="form-control-sm" name="name" value type="text" placeholder="Име" th:field="*{userName}" minlength="2" required>
                            <p class="text-danger" th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}"></p>
                        </div>

                        <div class="form-group">
                            <input class="form-control-sm" name="mobile" value type="text" placeholder="Телефон" th:field="*{mobile}" minlength="10" required>
                            <p class="text-danger" th:if="${#fields.hasErrors('mobile')}" th:errors="*{mobile}"></p>
                        </div>

                        <div class="form-group">
                            <input class="form-control-sm" id="inquiry-email" name="email" value type="email" placeholder="Имейл" th:field="*{email}" required>
                            <p class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>
                        </div>

                        <div class="form-group form-group-textarea">
                            <textarea class="form-control-sm form-message" name="message" rows="4" placeholder="Съобщение" th:text="*{userMessage}" th:field="*{userMessage}" required></textarea>
                            <p class="text-danger" th:if="${#fields.hasErrors('userMessage')}" th:errors="*{userMessage}"></p>
                        </div>

                        <div class="form-group">
                            <select name="user_type" class="selectpicker form-control-sm bs-select-hidden" title="Избери" th:field="*{inquiryType}" required>
                                <option th:value="${T(com.ludogorieSoft.villagelifefrontend.enums.InquiryType).OTHER}">Избери тип</option>
                                <option th:value="${inquiryType}" th:text="${inquiryType.name}"  th:each="inquiryType : ${T(com.ludogorieSoft.villagelifefrontend.enums.InquiryType).values()}"></option>
                            </select>
                            <p class="text-danger" th:if="${#fields.hasErrors('inquiryType')}" th:errors="*{inquiryType}"></p>
                        </div>

                        <div class="form-group">
                            <label class="control-checkbox" for="privacy_policy_checkbox">
                                <span class="custom-checkbox"></span>
                                <input type="checkbox" id="privacy_policy_checkbox" name="hasAgreed" th:field="*{hasAgreed}" required>
                                Изпращайки това съобщение аз се съгласявам с
                                <a target="_blank" th:href="@{/villages/general-terms}">
                                    Общите условия
                                </a>
                            </label>
                        </div>


                        <div class="form_messages"></div>

                        <div class="button-container">
                            <button type="submit" class="btn btn-secondary btn-half-width">
                                Изпрати
                            </button>

                            <a href="tel:+359888393339" id="callBtn" class="btn btn-secondary-outlined btn-half-width">
                                Обади се
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<div th:replace="fragments :: footer"></div>
<script src="/js/imageSlider.js"></script>
<script src="/js/accordion-script.js"></script>
<script src="/js/makeCallScript.js"></script>
<script>
  const isSent = [[${isSent}]];
</script>
<script src="/js/isSentMessageScript.js"></script>
<script src="/js/navScript.js"></script>
<script src="/js/handlePrint.js"></script>
<script src="/js/showSubscriptionToast.js"></script>
</body>
</html>