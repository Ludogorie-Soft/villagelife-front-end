<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="#{addVillage.title}"></title>
    <link th:href="@{/images/village-life-logo-icon.png}" rel="icon" type="image/png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src=https://code.jquery.com/jquery-3.6.0.js></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.2/js/bootstrap-select.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!--<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.2/css/bootstrap-select.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/0.8.2/css/flag-icon.min.css" rel="stylesheet" />


    <link rel="stylesheet" href="/css/menu-style-about-us.css">
    <link rel="stylesheet" href="/css/addVillage.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap">

<body>

<div th:replace="fragments :: menu"></div>
<div th:replace="fragments :: hamburger-menu"></div>

<div class="container">
    <div th:if="${consentMessage}" class="message alert alert-info text-center">
        <p th:text="${consentMessage}"></p>
    </div>
    <section class="lower-line-spacing">
        <p>
            <div th:text="#{addVillage.hello}"></div>
            <div th:text="#{please.fill.form}">
            </div>
        </p>
        <p th:text="#{thank.you}"></p>
        <p>
            <div th:text="#{regards}"></div>
            <div>Village Life</div>
        </p>
    </section>

    <form action="/villages/save" method="post" th:object="${addVillageFormResult}" enctype="multipart/form-data">
        <section>
            <p class="fw-bold" th:text="#{distance}"></p>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th></th>
                    <th th:each="distance : ${T(com.ludogorieSoft.villagelifefrontend.enums.Distance).values()}"
                        th:text="#{${distance.name}}"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="object : ${objectsAroundVillage}">
                    <td th:text="#{${object.type}}"></td>
                    <td th:each="distance1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Distance).values()}">
                        <div class="radio-wrapper">
                            <input type="radio" th:id="${'distance-' + object.id}"
                                   th:name="objectVillageDTOS[__${object.id}__].distance"
                                   th:value="${distance1}"
                                   th:disabled="${object.type == 'областен град' && distance1 == T(com.ludogorieSoft.villagelifefrontend.enums.Distance).IN_THE_VILLAGE}"  class="radio-button"/>
                            <input type="hidden" th:id="${'object-' + object.id}"
                                   th:name="objectVillageDTOS[__${object.id}__].objectAroundVillageId"
                                   th:value="${object.id}"/>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>


        <div class="row">
            <!-- Village name -->
            <section class="col-9">
                <label for="villageName" class="fw-bold" th:text="#{village.name.how}">
                    <span class="text-danger">*</span>
                </label>
                <input type="text" id="villageName" th:field="*{villageDTO.name}" class="form-control">
                <p class="text-danger" th:if="${#fields.hasErrors('villageDTO.name')}" th:errors="*{villageDTO.name}" th:text="#{error.villageDTO.name}"></p>
            </section>

            <!-- Region -->
            <section class="col-md-3 col-9 mb-3">
                <label for="regionName" class="fw-bold" th:text="#{choose.region}">
                    <span class="text-danger">*</span>
                </label>
                <select th:field="*{villageDTO.region}" class="form-select" id="regionName" required>
                    <option value="Избери област" th:text="#{choose.region}"></option>
                    <option th:each="region : ${regions}" th:value="${region.regionName}" th:text="#{${region.regionName}}"></option>
                </select>
                <p class="text-danger" th:if="${#fields.hasErrors('villageDTO.region')}" th:errors="*{villageDTO.region}"></p>
            </section>

        </div>

        <section id="groundCategory">
            <p class="fw-bold" th:text="#{village.category}">
                <span class="text-danger">*</span>
            </p>
            <div th:each="groundCategory : ${groundCategories}" class="checkbox-wrapper">
                <input type="checkbox" th:id="${'groundCategory-' + groundCategory.id}"
                       th:name="groundCategoryIds"
                       th:value="${groundCategory.id}" class="checkbox col"/>
                <label th:for="${'groundCategory-' + groundCategory.id}"
                       class="checkbox-label col" th:text="#{${groundCategory.groundCategoryName}}"></label>
            </div>
            <p class="text-danger" th:if="${#fields.hasErrors('groundCategoryIds')}" th:errors="*{groundCategoryIds}"></p>
            <p class="text-danger" id="ground-category-checkbox-error" style="display: none;" th:text="#{please.choose}"></p>
        </section>

        <!--             Consents          -->
        <section class="lg-consents">
            <p class="fw-bold" th:text="#{statements}"></p>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th></th>
                    <th th:each="consent : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}"
                        th:text="#{${consent.name}}" class="consent-th"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="livingCondition : ${livingConditions}" th:if="${livingCondition.id < 9}">
                    <td th:text="#{${livingCondition.livingConditionName}}"></td>
                    <td th:each="consent1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}">
                        <div class="radio-wrapper">
                            <input type="radio" th:id="${'consent-' + livingCondition.id}"
                                   th:name="villageLivingConditionDTOS[__${livingCondition.id}__].consents"
                                   th:value="${consent1}"  class="radio-button"/>
                            <input type="hidden" th:id="${'livingCondition-' + livingCondition.id}"
                                   th:name="villageLivingConditionDTOS[__${livingCondition.id}__].livingConditionId"
                                   th:value="${livingCondition.id}" />
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>


        <section class="sm-consents">
            <p class="fw-bold" th:text="#{statements}"></p>
            <table class="table table-hover">
                <tbody>
                <tr th:each="livingCondition : ${livingConditions}" th:if="${livingCondition.id < 9}">
                    <td th:text="#{${livingCondition.livingConditionName}}"></td>
                    <td>
                        <select th:id="${'consentSelect-' + livingCondition.id}"
                                th:name="villageLivingConditionDTOS[__${livingCondition.id}__].consents"
                                class="form-select">
                            <option th:each="consent1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}"
                                    th:value="${consent1}"
                                    th:text="#{${consent1.name}}">Consent Option</option>
                        </select>
                        <input type="hidden"
                               th:id="${'livingCondition-' + livingCondition.id}"
                               th:name="villageLivingConditionDTOS[__${livingCondition.id}__].livingConditionId"
                               th:value="${livingCondition.id}" />
                    </td>
                </tr>
                </tbody>
            </table>
        </section>


        <section class="lg-consents">
            <p class="fw-bold" th:text="#{statements}"></p>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th></th>
                    <th th:each="consent : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}"
                        th:text="#{${consent.name}}" class="consent-th"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="livingCondition : ${livingConditions}" th:if="${livingCondition.id > 8}">
                    <td th:text="#{${livingCondition.livingConditionName}}"></td>
                    <td th:each="consent1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}">
                        <div class="radio-wrapper">
                            <input type="radio" th:id="${'consent-' + livingCondition.id}"
                                   th:name="villageLivingConditionDTOS[__${livingCondition.id}__].consents"
                                   th:value="${consent1}"  class="radio-button"/>
                            <input type="hidden" th:id="${'livingCondition-' + livingCondition.id}"
                                   th:name="villageLivingConditionDTOS[__${livingCondition.id}__].livingConditionId"
                                   th:value="${livingCondition.id}" />
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>

        <section class="sm-consents">
            <p class="fw-bold" th:text="#{statements}"></p>
            <table class="table table-hover">
                <tbody>
                <tr th:each="livingCondition : ${livingConditions}" th:if="${livingCondition.id > 8}">
                    <td th:text="#{${livingCondition.livingConditionName}}"></td>
                    <td class="col">
                        <select th:id="${'consentSelect-' + livingCondition.id}"
                                th:name="villageLivingConditionDTOS[__${livingCondition.id}__].consents"
                                class="form-select">
                            <option th:each="consent1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}"
                                    th:value="${consent1}"
                                    th:text="#{${consent1.name}}">Consent Option</option>
                        </select>
                        <input type="hidden"
                               th:id="${'livingCondition-' + livingCondition.id}"
                               th:name="villageLivingConditionDTOS[__${livingCondition.id}__].livingConditionId"
                               th:value="${livingCondition.id}" />
                    </td>
                </tr>
                </tbody>
            </table>
        </section>


        <!-- PopulationCount -->
        <section>
            <label for="villagePopulationCount" class="fw-bold" th:text="#{village.population}">
                <span class="text-danger">*</span>
            </label>
            <input type="number" id="villagePopulationCount" th:field="*{populationDTO.populationCount}" class="form-control" required min="1" >
            <p class="text-danger" th:if="${#fields.hasErrors('populationDTO.populationCount')}" th:errors="*{populationDTO.populationCount}"></p>
        </section>

        <!-- Residents -->
        <section>
            <p class="fw-bold" th:text="#{population}">
                <span class="text-danger">*</span>
            </p>
            <div th:each="residents : ${T(com.ludogorieSoft.villagelifefrontend.enums.Residents).values()}"
                 class="radio-wrapper">
                <input type="radio" th:id="${'residents-' + residents}"
                       th:name="populationDTO.residents"
                       th:value="${residents}" class="radio-button" required/>
                <label th:for="${'residents-' + residents}"
                       class="radio-label" th:text="#{${residents.name}}"></label>
            </div>
            <p class="text-danger" th:if="${#fields.hasErrors('populationDTO.residents')}" th:errors="*{populationDTO.residents}"></p>
        </section>

        <!-- Children -->
        <section>
            <p class="fw-bold" th:text="#{population.children}">

                <span class="text-danger">*</span>
            </p>
            <div th:each="children : ${T(com.ludogorieSoft.villagelifefrontend.enums.Children).values()}"
                 class="radio-wrapper">
                <input type="radio" th:id="${'children-' + children}"
                       th:name="populationDTO.children"
                       th:value="${children}" class="radio-button" required/>
                <label th:for="${'children-' + children}"
                       class="radio-label" th:text="#{${children.name}}"></label>
            </div>
            <p class="text-danger" th:if="${#fields.hasErrors('populationDTO.children')}" th:errors="*{populationDTO.children}"></p>
        </section>

        <!-- Foreigners -->
        <section>
            <p class="fw-bold" th:text="#{population.foreigners}">
                <span class="text-danger">*</span>
            </p>
            <div th:each="foreigners : ${T(com.ludogorieSoft.villagelifefrontend.enums.Foreigners).values()}"
                 class="radio-wrapper">
                <input type="radio" th:id="${'foreigners-' + foreigners}"
                       th:name="populationDTO.foreigners"
                       th:value="${foreigners}" class="radio-button" required/>
                <label th:for="${'foreigners-' + foreigners}"
                       class="radio-label" th:text="#{${foreigners.name}}"></label>
            </div>
            <p class="text-danger" th:if="${#fields.hasErrors('populationDTO.foreigners')}" th:errors="*{populationDTO.foreigners}"></p>
        </section>


        <section id="ethnicity">
            <p class="fw-bold" th:text="#{population.minority}">
                <span class="text-danger">*</span>
            </p>
            <div th:each="ethnicity : ${ethnicities}" class="checkbox-wrapper">
                <input type="checkbox" th:id="${'ethnicity-' + ethnicity.id}"
                       th:name="ethnicityDTOIds"
                       th:value="${ethnicity.id}" class="checkbox" />
                <label th:for="${'ethnicity-' + ethnicity.id}"
                       class="checkbox-label" th:text="#{${ethnicity.ethnicityName}}"></label>
            </div>
            <p class="text-danger" th:if="${#fields.hasErrors('ethnicityDTOIds')}" th:errors="*{ethnicityDTOIds}"></p>
            <p class="text-danger" id="ethnicity-checkbox-error" style="display: none;" th:text="#{please.choose}"></p>
        </section>

        <!-- Questions -->
        <section>
            <div th:each="question, questionIndex : ${questions}" class="question-wrapper">
                <label th:for="${'question-' + questionIndex}" class="question-label fw-bold" th:text="#{${question.question}}"></label><br>
                <textarea th:id="${'question-' + questionIndex}" th:field="*{questionResponses[__${questionIndex.index}__]}" rows="4" class="form-control"></textarea>
            </div>
        </section>

        <section>
            <p class="fw-bold" th:text="#{statements.population}"><span class="legend">(5 -> Напълно съгласен; 4 -> По-скоро съгласен; 3 -> Не мога да преценя; 2 -> По-скоро не съм съгласен; 1 -> Не съм съгласен)</span></p>
            <table  class="table table-hover">
                <thead>
                <tr>
                    <th></th>
                    <th th:each="consent : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}"
                        th:text="#{${consent.name}}" class="consent-th"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="populatedAssertion : ${populatedAssertions}">
                    <td th:text="#{${populatedAssertion.populatedAssertionName}}"></td>
                    <td th:each="consent1 : ${T(com.ludogorieSoft.villagelifefrontend.enums.Consents).values()}">
                        <div class="radio-wrapper">
                            <input type="radio" th:id="${'consent-' + populatedAssertion.id}"
                                   th:name="villagePopulationAssertionDTOS[__${populatedAssertion.id}__].answer"
                                   th:value="${consent1}" class="radio-button" />
                            <input type="hidden" th:id="${'populatedAssertion-' + populatedAssertion.id}"
                                   th:name="villagePopulationAssertionDTOS[__${populatedAssertion.id}__].populatedAssertionId"
                                   th:value="${populatedAssertion.id}" />
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </section>

        <!--input field for uploading images-->
        <section>
            <div class="mb-3">
                <label for="formFileMultiple" class="form-label fw-bold" th:text="#{photos}"></label>
                <input class="form-control" id="formFileMultiple" name="images" type="file" multiple accept="image/*" onchange="validateImageFormat(this)">
                <span class="text-muted" th:text="#{photos.max.size}"></span>
            </div>

            <div id="consentAndInfoContainer" style="display: none;">
                <p th:text="#{photos.confirm}"></p>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="fullName" class="form-label fw-bold" th:text="#{user.name.lasName}"></label>
                        <input th:field="*{userDTO.fullName}" type="text" class="form-control" id="fullName" name="userDTO.fullName">
                        <p class="text-danger" th:if="${#fields.hasErrors('userDTO.fullName')}" th:errors="*{userDTO.fullName}"></p>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label fw-bold" th:text="#{user.email}"></label>
                        <input th:filed="*{userDTO.email}" type="email" class="form-control" id="email" name="userDTO.email">
                        <p class="text-danger" th:if="${#fields.hasErrors('userDTO.email')}" th:errors="*{userDTO.email}"></p>
                    </div>
                </div>

                <div class="checkbox-wrapper-43">
                    <input th:checked="*{userDTO.consent}" type="checkbox" id="cbx-43" class="form-check-input" name="userDTO.consent">
                    <label for="cbx-43" class="check">
                        <svg width="18px" height="18px" viewBox="0 0 18 18">
                            <path d="M1,9 L1,3.5 C1,2 2,1 3.5,1 L14.5,1 C16,1 17,2 17,3.5 L17,14.5 C17,16 16,17 14.5,17 L3.5,17 C2,17 1,16 1,14.5 L1,9 Z"></path>
                            <polyline points="1 9 7 14 15 4"></polyline>
                        </svg>
                    </label>
                    <label class="form-check-label" for="cbx-43" th:text="#{consent}"></label>
                    <p class="text-danger" th:if="${#fields.hasErrors('userDTO.consent')}" th:errors="*{userDTO.consent}"></p>
                </div>

            </div>
        </section>

        <section class="text-center">
            <button type="submit" onclick="return validateGroundCategory() && validateEthnicity()" class="btn btn-primary" th:text="#{send.village}"></button>
        </section>

    </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/validateImageFormat.js"></script>
<script src="/js/navScript.js"></script>
<script src="/js/consentScript.js"></script>
<script src="/js/validateGroundCategory.js"></script>
<script src="/js/validateEthnicity.js"></script>
<script>
window.addEventListener('resize', updateConsentText);

function updateConsentText() {
    const screenWidth = window.innerWidth;
    const consentThElements = document.querySelectorAll('.consent-th');

    consentThElements.forEach((element, index) => {
        const originalText = element.getAttribute('data-original-text');

        if (screenWidth <= 676) {
            let newHeaderText;
            switch(originalText){
                case "Напълно съгласен": newHeaderText = 5; break;
                case "По-скоро съгласен": newHeaderText = 4; break;
                case "Не мога да преценя": newHeaderText = 3; break;
                case "По-скоро не съм съгласен": newHeaderText = 2; break;
                case "Не съм съгласен": newHeaderText = 1; break;
            }
            element.textContent = newHeaderText;
        } else {
            element.textContent = originalText;
        }
    });
}

const consentThElements = document.querySelectorAll('.consent-th');
consentThElements.forEach((element) => {
    element.setAttribute('data-original-text', element.textContent.trim());
});

updateConsentText();
</script>
</body>
</html>